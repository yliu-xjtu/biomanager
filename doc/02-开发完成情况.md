# 开发完成情况

## 一、完成状态总览

| 模块 | 文件 | 状态 | 说明 |
|------|------|------|------|
| 数据库 | db/schema.sql | ✅ 完成 | SQL 建表脚本（含论文、专利、软著） |
| 数据库 | db/database.py | ✅ 完成 | CRUD 操作封装、标签管理 |
| 配置 | config.py | ✅ 完成 | API Key 配置 |
| 核心-扫描 | core/scanner.py | ✅ 完成 | 递归扫描、增量更新 |
| 核心-抽取 | core/extractor.py | ✅ 完成 | PDF 元数据抽取、专利/软著证书解析 |
| 核心-解析 | core/resolver.py | ✅ 完成 | Crossref + OpenAlex API、评分逻辑 |
| 核心-OCR | core/ocr.py | ✅ 完成 | OCR 接口（支持 LLM API） |
| 核心-导出 | core/export.py | ✅ 完成 | 多格式导出（BibTeX/RIS/CSV） |
| 核心-导出 | core/bibtex.py | ✅ 完成 | BibTeX 生成 + GB/T 7714 渲染 |
| 核心-代理 | core/proxy.py | ✅ 完成 | HTTP 代理配置 |
| 核心-影响因子 | core/journal_impact.py | ✅ 完成 | 期刊影响因子查询 |
| 核心-LLM | core/llm_parser.py | ✅ 完成 | LLM 解析专利/软著信息 |
| UI-模型 | ui/table_model.py | ✅ 完成 | 论文表格模型 |
| UI-模型 | ui/patent_table_model.py | ✅ 完成 | 专利表格模型 |
| UI-模型 | ui/software_table_model.py | ✅ 完成 | 软著表格模型 |
| UI-面板 | ui/detail_panel.py | ✅ 完成 | 论文详情编辑面板 |
| UI-面板 | ui/patent_detail_panel.py | ✅ 完成 | 专利详情编辑面板 |
| UI-面板 | ui/software_detail_panel.py | ✅ 完成 | 软著详情编辑面板 |
| UI-窗口 | ui/main_window.py | ✅ 完成 | 主窗口、多标签页、统计报表 |
| UI-主题 | ui/theme.py | ✅ 完成 | 深色/浅色主题切换 |
| 入口 | app/app.py | ✅ 完成 | 程序入口 |
| 启动 | startup_dialog.py | ✅ 完成 | 启动对话框（新建/打开数据库） |
| 样式 | csl/gb-t-7714-2015.csl | ✅ 完成 | CSL 样式文件 |

## 二、功能实现清单

### 2.1 数据库层
- [x] SQLite 数据库初始化（schema.sql）
- [x] papers 表增删改查
- [x] patents 表增删改查
- [x] softwares 表增删改查
- [x] tags 标签管理（论文/专利/软著独立标签）
- [x] 增量更新判断逻辑
- [x] 数据库备份与恢复

### 2.2 文件扫描
- [x] 递归扫描 `*.pdf` / `*.PDF`
- [x] SHA256 文件哈希计算
- [x] 基于 path/size/mtime 的增量判断
- [x] 自动识别论文/专利/软著类型
- [x] 异常处理与错误记录

### 2.3 元数据抽取
- [x] PyMuPDF 提取 PDF 元数据
- [x] DOI 正则提取
- [x] 年份正则提取
- [x] 摘要提取（支持多种格式：Elsevier、IEEE、中文等）
- [x] 专利证书信息提取（专利号、发明人、授权日等）
- [x] 软著证书信息提取（登记号、著作权人等）
- [x] OCR 需求判断

### 2.4 在线 DOI 补全
- [x] Crossref API 查询
- [x] OpenAlex API 查询
- [x] 评分算法（标题 40% + 年份 20% + 第一作者 20% + venue 20%）
- [x] 阈值判断（>=80 自动写入，<80 标记 needs_review）
- [x] 网络请求重试（指数退避）
- [x] HTTP 代理支持

### 2.5 OCR 接口
- [x] `ocr_pdf_page()` 接口定义
- [x] 支持 LLM API（如 OpenAI 兼容接口）
- [x] API Key 配置读取
- [x] 专利/软著证书 OCR 解析

### 2.6 文献导出
- [x] BibTeX 条目生成
- [x] BibTeX Key 生成（多种模式可选）
- [x] RIS 格式导出（EndNote/Zotero 兼容）
- [x] GB/T 7714-2015 格式渲染
- [x] 专利 CSV 导出
- [x] 软著 CSV 导出
- [x] 导出到文件 / 复制到剪贴板

### 2.7 UI 功能

#### 论文管理
- [x] 表格列：标题、作者、年份、期刊、DOI、影响因子、BibKey 等
- [x] 表格可排序、可搜索
- [x] 标签筛选
- [x] 单击行 → 右侧详情编辑
- [x] 双击行 / Enter → 外部打开 PDF
- [x] 低置信度高亮
- [x] 多选导出
- [x] 手动触发 OCR 按钮
- [x] 手动重新查找 DOI 按钮
- [x] 批量更新影响因子
- [x] 批量更新 BibKey
- [x] 自动标签功能
- [x] 论文详情对话框（摘要提取、笔记编辑）

#### 专利管理
- [x] 表格列：专利名称、专利号、发明人、专利类型、授权日等
- [x] 专利详情编辑面板
- [x] 标签管理
- [x] OCR 识别专利证书

#### 软著管理
- [x] 表格列：软件名称、登记号、版本号、著作权人等
- [x] 软著详情编辑面板
- [x] 标签管理
- [x] OCR 识别软著证书

#### 通用功能
- [x] 多标签页切换（论文/专利/软著）
- [x] 深色/浅色主题切换
- [x] 扫描进度条显示
- [x] 状态栏消息提示
- [x] 快捷键支持
- [x] 统计报表（年度发文、期刊分布、类型分布）
- [x] 全文搜索（需建立索引）

### 2.8 快捷键
| 快捷键 | 功能 |
|--------|------|
| Ctrl+O | 打开数据库 |
| Ctrl+N | 新建数据库 |
| Ctrl+W | 关闭数据库 |
| F5 | 刷新数据库 |
| Ctrl+F | 搜索框聚焦 |
| Enter / 双击 | 打开 PDF/证书 |
| Delete | 删除选中项目 |
| Ctrl+S | 保存修改 |
| Ctrl+Up/Down | 上移/下移选中项 |
| Ctrl+1/2/3 | 切换标签页 |
| Ctrl+Q | 退出程序 |

## 三、验收标准完成情况

| 验收项 | 状态 | 说明 |
|--------|------|------|
| 选择文件夹后能递归扫描并增量更新 | ✅ | 基于 mtime/size/sha256 判断 |
| 能抽取 DOI（至少基于第一页文本正则） | ✅ | DOI_REGEX 正则匹配 |
| 无 DOI 能走 Crossref 查询并按评分阈值自动补全或标记 needs_review | ✅ | 评分算法 + 80 分阈值 |
| OCR 条目能被标记 needs_ocr，且用户点击按钮可调用 OCR 接口 | ✅ | 支持 LLM API |
| 表格展示与详情编辑正常，双击打开 PDF 正常 | ✅ | os.startfile 打开 |
| 可导出 BibTeX 与 GB/T 7714 文本 | ✅ | 文件导出 + 剪贴板复制 |
| 支持专利管理 | ✅ | 专利证书 OCR + 详情编辑 |
| 支持软著管理 | ✅ | 软著证书 OCR + 详情编辑 |
| 支持标签分类 | ✅ | 论文/专利/软著独立标签 |

## 四、已知限制

1. **OCR**：需配置 `config.OCR_API_KEY` 和 `config.OCR_API_URL` 才能执行
2. **GB/T 7714**：简化渲染实现，完整规范需 citeproc 库支持
3. **网络请求**：可配置代理，在国内网络环境下建议使用代理
4. **PDF 预览**：仅支持外部打开，不支持内嵌预览

## 五、日志与错误处理

- 日志输出到 `app.log` 文件和控制台
- 所有异常写入相应的 parse_error 字段
- 程序启动时自动创建数据库和表
- 扫描失败不会导致程序崩溃

## 六、打包说明

### 方法一：使用 build.bat（推荐）
```bash
build.bat
```

### 方法二：使用 PyInstaller 命令
```bash
pip install pyinstaller
pyinstaller build.spec
```

### 方法三：简单打包
```bash
pyinstaller --onefile --windowed --name "BioManager" app/app.py
```

打包后的可执行文件位于 `dist/BioManager.exe`。
